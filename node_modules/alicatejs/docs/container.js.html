<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/container.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/container.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Created by dmitriy.ryajov on 6/30/14.
 */

'use strict';

var Component = require('./component'),
    $ = require('jquery');

/**
 * A module representing a container
 *
 * @module Container
 * @exports alicate/components/container
 * @extends Component
 * @version 1.0
 */
var Container = Component.extend({
    initialize: function initialize() {
        Component.prototype.initialize.call(this);

        for (var key in this.children) {
            if (this.children[key].isVisible()) {
                this.children[key].visible = this.visible;
            }
        }
    },
    instanceData: function instanceData() {
        return {
            /**
             * @property {Object} components - List of components
             * that have been attached to this view.
             */
            children: []
        };
    },
    /**
     * Add a component to the view. Components that are not added explicitly
     * are still going to be added by the alicate, and their model will be constructed
     * from the view model if one is provided.
     *
     * @param {Component} cpm - Component to be added to this container
     * @param {String} id - Id of the component to be added
     * @return this
     */
    add: function add(cpm) {
        this.children.push(cpm);
        return this;
    },
    /**
     * Replace a component with another component
     *
     * @param {Component} cmp - The new component
     * @param {String} id - The id of the component to be replaced
     */
    replace: function replace(newCmp, id) {
        for (var cpm in this.children) {
            if (this.children[cpm].id === id) {
                var oldCmp = this.children[cpm];
                this.children[cpm] = newCmp;
                return oldCmp;
            }
        }
    },
    /**
     * Removes a component from this container
     *
     * @param {String} id - Id of the component to be removed
     */
    remove: function remove(id) {
        for (var cpm in this.children) {
            if (this.children[cpm].id === id) {

                if (this.isBound) {
                    this.$el.remove(this.children[cpm]);
                }

                delete this.children[cpm];
            }
        }
    },
    /**
     * Get a component by id
     *
     * @param {String} id - Id of the component to retrieve
     * @returns {Component}
     */
    get: function get(id) {
        for (var cpm in this.children) {
            if (this.children[cpm].id === id) {
                return this.children[cpm];
            }
        }
        return null;
    },
    append: function append(cmp) {
        if (this.isBound) {
            this.add(cmp);
            this.$el.append(cmp.$el);
            this.render();
        } else {
            throw "Element not bound, can't append!";
        }
    },
    preppend: function preppend(cmp) {
        if (this.isBound) {
            this.add(cmp);
            this.$el.preppend(cmp.$el);
            this.render();
        } else {
            throw "Element not bound, can't preppend!"
        }
    },
    /**
     * Get the number of children components
     *
     * @returns {Number}
     */
    getChildrenCount: function getChildrenCount() {
        return Object.keys(this.children).length;
    },
    /**
     * Set component visibility
     *
     * @param {Boolean} visible - Set visible/hidden
     */
    setVisible: function setVisible(visible) {
        Component.prototype.setVisible.call(this, visible);

        if (this.isBound) {
            this.render();
        }
    },
    _updateVisiblity: function _updateVisiblity() {
        for (var key in this.children) {
            this.children[key].visible = this.visible;
            if (this.children[key] instanceof Container) {
                this.children[key]._updateVisiblity();
            }
        }
    },
    /**
     * Scan the template and attach components to html elements
     *
     * @param {MarkupIter} markupIter - A markup iterator
     * @return {void}
     */
    bind: function bind(markupIter) {
        Component.prototype.bind.call(this, markupIter);

        var id, cmp,
            $element;

        if (!markupIter.nextNode()) {
            return;
        }

        do {
            $element = $(markupIter.currentNode);
            id = $element.data().aid;
            if (id &amp;&amp; id.length > 0) {
                cmp = this.get(id);
                if (cmp) {
                    console.log('binding element id ' + id);
                    this.bindComponent(cmp, $element);
                    cmp.bind(markupIter);
                } else {
                    // backup one step so that the next component
                    // picks it up from where we left
                    markupIter.previousNode();
                    return;
                }
            }
        } while (markupIter.nextNode());
    },
    /**
     * Bind the current component to the provided element
     *
     * @param {Component} cmp - The component to bind
     * @param {jQuery} $element - jQuery wrapped dom element
     */
    bindComponent: function bindComponent(cmp, $element) {
        // if this is a function then call it,
        // it should construct a component
        if (typeof cmp === 'function') {
            cmp = cmp();
            this.replace(cmp);
        }

        cmp.$el = $element;
        cmp.parent = this;

        cmp.bindModel();
        cmp.bindBehaviors();
    },
    /**
     * Render the component tree
     */
    render: function render() {
        if (this._updateVisiblity) {
            this._updateVisiblity();
        }

        // run through the list of components
        // and render them
        for (var key in this.children) {
            this.children[key].render();
        }

        Component.prototype.render.call(this);
    }
});

module.exports = Container;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-AlicateApp.html">AlicateApp</a></li><li><a href="module-Behavior.html">Behavior</a></li><li><a href="module-Button.html">Button</a></li><li><a href="module-Component.html">Component</a></li><li><a href="module-Container.html">Container</a></li><li><a href="module-Eventable.html">Eventable</a></li><li><a href="module-Image.html">Image</a></li><li><a href="module-Input.html">Input</a></li><li><a href="module-Label.html">Label</a></li><li><a href="module-MarkupIter.html">MarkupIter</a></li><li><a href="module-Model.html">Model</a></li><li><a href="module-Observable.html">Observable</a></li><li><a href="module-Repeater.html">Repeater</a></li><li><a href="module-Router.html">Router</a></li><li><a href="module-Select.html">Select</a></li><li><a href="module-View.html">View</a></li></ul><h3>Classes</h3><ul><li><a href="Base.html">Base</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a> on Fri Mar 27 2015 01:01:14 GMT-0600 (MDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
